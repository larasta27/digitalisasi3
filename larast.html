<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Hijaiyyah Learning</title>

<!-- PWA meta tags -->
<meta name="theme-color" content="#f7a072" />
<link rel="manifest" href="manifest.json" />
<link rel="apple-touch-icon" href="icons/icon-192x192.png" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

<style>
  @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&family=Quicksand&display=swap');

  :root {
    --primary-color: #30534f;
    --secondary-color: #ffc43c;
    --background-color: #f5eed1;
    --text-color: #3b2d0f;
    --accent-color: #3b2d0f;
    --font-size-base: 18px;
  }

  body {
    margin: 0;
    font-family: 'Quicksand', sans-serif;
    background: var(--background-color);
    color: var(--text-color);
    overflow-x: hidden;
  }

  header {
    background: var(--primary-color);
    padding: 20px;
    text-align: center;
    font-family: 'Fredoka One', cursive;
    font-size: 2.8rem;
    color: white;
    user-select: none;
    box-shadow: 0 4px 6px rgb(0 0 0 / 0.1);
    position: sticky;
    top: 0;
    z-index: 10;
  }

  #logo {
    width: 140px;
    margin-top: 10px;
    margin-bottom: 15px;
  }

  nav {
    display: flex;
    justify-content: space-around;
    background: var(--secondary-color);
    padding: 10px 0;
    box-shadow: inset 0 -3px 7px -2px rgb(0 0 0 / 0.1);
    flex-wrap: wrap;
    gap: 6px;
  }

  nav button {
    background: transparent;
    border: none;
    font-weight: 700;
    font-size: 1.1rem;
    color: var(--primary-color);
    cursor: pointer;
    padding: 8px 18px;
    border-radius: 20px;
    transition: background-color 0.3s ease, color 0.3s ease;
    user-select: none;
    min-width: 110px;
  }
  nav button:hover, nav button.active {
    background: var(--primary-color);
    color: white;
  }

  main {
    padding: 15px 20px;
    min-height: calc(100vh - 165px);
  }

  .content-section {
    animation: fadeIn 0.6s ease forwards;
    opacity: 0;
  }

  @keyframes fadeIn {
    to {opacity:1;}
  }

  /* Card styling */
  .card {
    background: white;
    border-radius: 15px;
    padding: 15px 20px;
    margin-bottom: 20px;
    box-shadow: 0 5px 15px rgb(0 0 0 / 0.1);
  }

  h2 {
    margin: 0 0 12px;
    color: var(--accent-color);
    font-family: 'Fredoka One', cursive;
  }

  /* Hijaiyah grid */
  .hijaiyah-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(60px,1fr));
    gap: 12px;
    justify-items: center;
  }

  .hijaiyah-letter {
    background: var(--secondary-color);
    border-radius: 12px;
    font-family: 'Fredoka One', cursive;
    font-size: 28px;
    padding: 15px 0;
    color: var(--primary-color);
    width: 60px;
    text-align: center;
    user-select: none;
    box-shadow: inset 0 0 12px rgb(245 210 80 / 0.7);
    cursor: pointer;
    transition: transform 0.2s ease;
  }
  .hijaiyah-letter:active {
    transform: scale(1.3);
  }

  /* Doa & surat lists */
  .list-item {
    margin-bottom: 14px;
    cursor: pointer;
    padding: 8px 12px;
    border-radius: 10px;
    background: var(--secondary-color);
    color: var(--primary-color);
    font-weight: 600;
    user-select: none;
    box-shadow: inset 0 0 15px rgb(255 220 80 / 0.9);
    transition: background-color 0.3s ease;
  }
  .list-item:hover {
    background: var(--primary-color);
    color: white;
  }

  .list-item.active {
    background: var(--primary-color);
    color: white;
  }

  .translation {
    margin-top: 4px;
    font-size: 16px;
    font-style: italic;
    color: #666;
  }

  /* Settings */
  .setting-label {
    display: flex;
    justify-content: space-between;
    margin: 15px 0 6px 0;
    font-weight: 600;
  }
  .setting-input {
    width: 100%;
    padding: 8px;
    border-radius: 12px;
    border: 2px solid var(--secondary-color);
    font-size: 16px;
  }
  .switch {
    position: relative;
    display: inline-block;
    width: 46px;
    height: 26px;
  }
  .switch input {display:none;}
  .slider {
    position: absolute;
    cursor: pointer;
    top: 0; left: 0; right: 0; bottom: 0;
    background-color: #ccc;
    transition: .4s;
    border-radius: 26px;
  }
  .slider:before {
    position: absolute;
    content:"";
    height: 20px;
    width: 20px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
  }
  input:checked + .slider {
    background-color: var(--primary-color);
  }
  input:checked + .slider:before {
    transform: translateX(20px);
  }

  /* Footer */
  footer {
    text-align: center;
    padding: 10px 15px;
    color: #888;
    font-size: 0.9rem;
    background: #eee;
    user-select: none;
  }

  /* Responsive */
  @media (max-width:400px) {
    nav {
      flex-wrap: wrap;
      gap: 8px;
    }
    main {
      padding: 15px 10px;
    }
  }
</style>
</head>
<body>
<header>
  <div>Hijaiyyah Learning</div>
  <img id="logo" src="https://i.ibb.co/tH06snQ/hijaiyyah-logo-anak.png" alt="Anak Mengaji" title="Hijaiyyah Learning Logo" />
</header>

<nav>
  <button class="active" aria-label="Menu Hijaiyah" id="menu-hijaiyah">Hijaiyah</button>
  <button aria-label="Menu Doa Sehari-hari" id="menu-doa">Doa Sehari-hari</button>
  <button aria-label="Menu Surat Pendek" id="menu-surat">Surat Pendek</button>
  <button aria-label="Menu Pengaturan" id="menu-setting">Setting</button>
  <button aria-label="Menu Tentang" id="menu-about">About</button>
</nav>

<main>
  <!-- Container untuk konten dinamis -->
  <section id="content" class="content-section" tabindex="0">
    <!-- konten akan masuk di sini -->
  </section>
</main>

<footer>
  &copy; 2024 Hijaiyyah Learning | Digitalisasi Al-Qur'an - Mahasiswa 2022 IAI Persis Garut
</footer>

<script>
  // Service Worker Registrasi
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('sw.js')
        .then(reg => {
          console.log('Service Worker terdaftar dengan scope:', reg.scope);
        }).catch(err => {
          console.error('Service Worker registrasi gagal:', err);
        });
    });
  }

  // Data huruf hijaiyah alif sampai ya
  const hijaiyahLetters = [
    "ا", "ب", "ت", "ث", "ج", "ح", "خ",
    "د", "ذ", "ر", "ز", "س", "ش", "ص",
    "ض", "ط", "ظ", "ع", "غ", "ف", "ق",
    "ك", "ل", "م", "ن", "ه", "و", "ي"
  ];

  // Data Doa sehari-hari: doa + terjemahan
  const doaList = [
    {title: "Doa Mau Makan", arab: "اللّهُمَّ بَارِكْ لَنَا فِيمَا رَزَقْتَنَا وَقِنَا عَذَابَ النَّارِ", translation: "Ya Allah, berkahilah kami dalam rizki yang telah Engkau berikan kepada kami dan peliharalah kami dari siksa api neraka."},
    {title: "Doa Sesudah Makan", arab: "الْحَمْدُ لِلّهِ الَّذِي أَطْعَمَنَا وَسَقَىٰنَا وَجَعَلَنَا مِنَ الْمُسْلِمِينَ", translation: "Segala puji bagi Allah yang telah memberi kami makan dan minum serta menjadikan kami termasuk orang-orang yang berserah diri."},
    {title: "Doa Mau Tidur", arab: "بِاسْمِكَ اللَّهُمَّ أَمُوتُ وَأَحْيَا", translation: "Dengan nama-Mu ya Allah, aku mati dan aku hidup."},
    {title: "Doa Bangun Tidur", arab: "الْحَمْدُ لِلَّهِ الَّذِي أَحْيَانَا بَعْدَ مَا أَمَاتَنَا وَإِلَيْهِ النُّشُورُ", translation: "Segala puji bagi Allah yang telah menghidupkan kami kembali setelah mematikan kami, dan hanya kepada-Nya kami kembali."},
    {title: "Doa Masuk WC", arab: "اللّهُــمَّ إِنِّي أَعـوذُ بِكَ مِنَ الْخُبُثِ وَالْخَبَائِثِ", translation: "Ya Allah, aku berlindung kepada Engkau dari godaan setan laki-laki dan perempuan."},
    {title: "Doa Keluar WC", arab: "غُفْرَانَكَ", translation: "Aku mohon ampunan-Mu."},
    {title: "Doa Masuk Rumah", arab: "بِسْمِ اللَّهِ وَلَجْنَا وَبِسْمِ اللَّهِ خَرَجْنَا وَعَلَى اللَّهِ رَبِّنَا تَوَكَّلْنَا", translation: "Dengan nama Allah kami memasuki dan dengan nama Allah kami keluar, dan kepada Allah Tuhan kami kami bertawakal."},
    {title: "Doa Keluar Rumah", arab: "بِسْمِ اللَّهِ تَوَكَّلْتُ عَلَى اللَّهِ وَلَا حَوْلَ وَلَا قُوَّةَ إِلَّا بِاللَّهِ", translation: "Dengan nama Allah aku bertawakal kepada Allah dan tidak ada daya dan kekuatan kecuali dengan Allah."},
    {title: "Doa Berpakaian", arab: "الْحَمْدُ لِلَّهِ الَّذِي كَسَانِي هَذَا (الثَّوْبَ) وَرَزَقَنِيهِ مِنْ غَيْرِ حَوْلٍ مِنِّي وَلَا قُوَّةٍ", translation: "Segala puji bagi Allah yang telah memberiku pakaian ini dan memberiku rezeki tanpa daya dan upaya dari diriku."},
    {title: "Doa Bercermin", arab: "سُبْحَانَ اللَّهِ وَبِحَمْدِهِ", translation: "Maha suci Allah dan aku memuji-Nya."},
  ];

  // Surat pendek dari juz 30, dari Al-Adiyat sampai An-Nas (versi dipersingkat)
  const suratList = [
    {name: "Al-Adiyat", arab: "وَالْعَادِيَاتِ ضَبْحًا", translation: "Demi kuda yang berlari kencang,"},
    {name: "Al-Qari'ah", arab: "الْقَارِعَةُ", translation: "Hari Kiamat."},
    {name: "At-Takatsur", arab: "الْكَاثِرَةُ", translation: "Bermegahan."},
    {name: "Al-Asr", arab: "وَالْعَصْرِ", translation: "Demi masa."},
    {name: "Al-Humazah", arab: "وَيْلٌ لِكُلِّ هُمَزَةٍ لُمَزَةٍ", translation: "Celakalah setiap pengumpat lagi pencela."},
    {name: "Al-Fil", arab: "أَلَمْ تَرَ كَيْفَ فَعَلَ رَبُّكَ بِأَصْحَابِ الْفِيلِ", translation: "Apakah kamu tidak memperhatikan bagaimana Tuhanmu bertindak terhadap tentara gajah?"},
    {name: "Al-Quraisy", arab: "لإيلَافِ قُرَيْشٍ", translation: "Karena kebiasaan orang-orang Quraisy."},
    {name: "Al-Ma'un", arab: "أَرَأَيْتَ الَّذِي يُكَذِّبُ بِالدِّينِ", translation: "Tahukah kamu orang yang mendustakan agama?"},
  ];

  // Global settings state
  let settings = {
    color: "#f7a072",
    fontSize: 18,
    soundEnabled: true,
  };

  // Elements refs
  const content = document.getElementById('content');
  const buttons = {
    hijaiyah: document.getElementById('menu-hijaiyah'),
    doa: document.getElementById('menu-doa'),
    surat: document.getElementById('menu-surat'),
    setting: document.getElementById('menu-setting'),
    about: document.getElementById('menu-about')
  };

  function clearActiveButtons() {
    for (const btn of Object.values(buttons)) {
      btn.classList.remove('active');
    }
  }

  // Create beep sound for click effect
  function playClickSound() {
    if (!settings.soundEnabled) return;
    try {
      let context = new (window.AudioContext || window.webkitAudioContext)();
      let o = context.createOscillator();
      let g = context.createGain();
      o.type = 'square';
      o.frequency.value = 800;
      o.connect(g);
      g.connect(context.destination);
      o.start(0);
      g.gain.exponentialRampToValueAtTime(0.00001, context.currentTime + 0.1);
      o.stop(context.currentTime + 0.1);
    } catch (e) {
      // fallback silent
    }
  }

  // Text to speech using male voice
  function speakText(text, lang='ar-SA') {
    if (!settings.soundEnabled) return;
    if (!('speechSynthesis' in window)) {
      alert('Browser tidak mendukung suara.');
      return;
    }

    // Cancel any ongoing speech
    speechSynthesis.cancel();

    const utterance = new SpeechSynthesisUtterance(text);

    function selectMaleVoice(voices) {
      // Coba cari suara laki-laki bahasa Arab
      const maleArab = voices.find(v =>
        v.lang.toLowerCase().startsWith(lang.toLowerCase()) &&
        /male|man|paul|david|husein/i.test(v.name)
      );
      if(maleArab) return maleArab;

      // Fallback laki-laki bahasa Indonesia
      const maleId = voices.find(v =>
        v.lang.toLowerCase().startsWith('id') &&
        /male|man|paul|david|husein/i.test(v.name)
      );
      if(maleId) return maleId;

      // fallback ke default laki laki
      const maleAny = voices.find(v => /male|man|paul|david|husein/i.test(v.name));
      if(maleAny) return maleAny;

      // fallback ke English yang laki laki
      const maleEng = voices.find(v => v.lang.toLowerCase().startsWith('en') && /male|man|paul|david|husein/i.test(v.name));
      if(maleEng) return maleEng;

      // fallback ke suara apa saja yang ada
      return voices[0];
    }

    let voices = speechSynthesis.getVoices();
    if(voices.length === 0){
      // Atur toakal delay get voices
      setTimeout(() => {
        voices = speechSynthesis.getVoices();
        if(voices.length>0) {
          utterance.voice = selectMaleVoice(voices);
          speechSynthesis.speak(utterance);
        }
      }, 200);
      return;
    }

    utterance.voice = selectMaleVoice(voices);
    utterance.lang = lang;
    speechSynthesis.speak(utterance);
  }

  // Fungsi untuk render halaman Hijaiyah
  function renderHijaiyah() {
    clearActiveButtons();
    buttons.hijaiyah.classList.add('active');

    content.innerHTML = `<h2>Huruf Hijaiyah</h2>`;
    const grid = document.createElement('div');
    grid.className = 'hijaiyah-grid';

    hijaiyahLetters.forEach(letter => {
      const div = document.createElement('div');
      div.className = 'hijaiyah-letter';
      div.textContent = letter;
      div.tabIndex = 0;
      div.title = 'Klik untuk dengar';
      div.addEventListener('click', () => {
        playClickSound();
        speakText(letter);
        flashElement(div);
      });

      // keyboard accessibility: enter or space triggers speech and sound
      div.addEventListener('keydown', e => {
        if(e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          playClickSound();
          speakText(letter);
          flashElement(div);
        }
      });

      grid.appendChild(div);
    });

    content.appendChild(grid);
  }

  // Fungsi untuk render halaman Doa sehari-hari
  function renderDoa() {
    clearActiveButtons();
    buttons.doa.classList.add('active');

    content.innerHTML = `<h2>Doa Sehari-hari</h2>`;
    doaList.forEach((doa, i) => {
      const div = document.createElement('div');
      div.className = 'list-item';
      div.tabIndex = 0;
      div.textContent = doa.title;

      div.addEventListener('click', () => {
        playClickSound();
        renderDoaDetail(i);
      });

      div.addEventListener('keydown', e => {
        if(e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          playClickSound();
          renderDoaDetail(i);
        }
      });

      content.appendChild(div);
    });
  }

  function renderDoaDetail(index) {
    const doa = doaList[index];
    content.innerHTML = `
      <h2>${doa.title}</h2>
      <div class="card" style="font-size:${settings.fontSize + 6}px; direction: rtl;">${doa.arab}</div>
      <div class="translation">${doa.translation}</div>
      <button id="btn-speak" style="margin-top:20px; background:${settings.color}; color:white; border:none; padding:10px 20px; font-weight:700; border-radius:12px; cursor:pointer; user-select:none;">Dengarkan</button>
      <button id="btn-back" style="margin-top:10px; background:#aaa; color:white; border:none; padding:10px 20px; font-weight:700; border-radius:12px; cursor:pointer; user-select:none;">Kembali</button>
    `;

    const btnSpeak = document.getElementById('btn-speak');
    const btnBack = document.getElementById('btn-back');
    btnSpeak.onclick = () => {
      playClickSound();
      speakText(doa.arab);
    };
    btnBack.onclick = () => {
      playClickSound();
      renderDoa();
    };
  }

  // Fungsi untuk render halaman Surat Pendek
  function renderSurat() {
    clearActiveButtons();
    buttons.surat.classList.add('active');

    content.innerHTML = `<h2>Surat Pendek (Juz 30)</h2>`;
    suratList.forEach((surat, i) => {
      const div = document.createElement('div');
      div.className = 'list-item';
      div.tabIndex = 0;
      div.textContent = surat.name;

      div.addEventListener('click', () => {
        playClickSound();
        renderSuratDetail(i);
      });

      div.addEventListener('keydown', e => {
        if(e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          playClickSound();
          renderSuratDetail(i);
        }
      });

      content.appendChild(div);
    });
  }

  function renderSuratDetail(index) {
    const surat = suratList[index];
    content.innerHTML = `
      <h2>${surat.name}</h2>
      <div class="card" style="font-size:${settings.fontSize + 6}px; direction: rtl;">${surat.arab}</div>
      <div class="translation">${surat.translation}</div>
      <button id="btn-speak" style="margin-top:20px; background:${settings.color}; color:white; border:none; padding:10px 20px; font-weight:700; border-radius:12px; cursor:pointer; user-select:none;">Dengarkan</button>
      <button id="btn-back" style="margin-top:10px; background:#aaa; color:white; border:none; padding:10px 20px; font-weight:700; border-radius:12px; cursor:pointer; user-select:none;">Kembali</button>
    `;

    const btnSpeak = document.getElementById('btn-speak');
    const btnBack = document.getElementById('btn-back');
    btnSpeak.onclick = () => {
      playClickSound();
      speakText(surat.arab);
    };
    btnBack.onclick = () => {
      playClickSound();
      renderSurat();
    };
  }

  // Fungsi untuk render Setting
  function renderSetting() {
    clearActiveButtons();
    buttons.setting.classList.add('active');
    content.innerHTML = `
      <h2>Pengaturan</h2>
      <label class="setting-label" for="colorInput">Warna Tema:</label>
      <input type="color" id="colorInput" class="setting-input" value="${settings.color}" aria-label="Pilih warna tema" />

      <label class="setting-label" for="fontSizeInput">Ukuran Huruf (px):</label>
      <input type="number" id="fontSizeInput" class="setting-input" value="${settings.fontSize}" min="12" max="40" aria-label="Atur ukuran huruf" />

      <label class="setting-label" for="soundToggle">Suara Aktifkan:</label>
      <label class="switch" title="Aktifkan atau nonaktifkan suara baca">
        <input type="checkbox" id="soundToggle" ${settings.soundEnabled ? 'checked' : ''} aria-label="Toggle suara aktif/nonaktif" />
        <span class="slider"></span>
      </label>
    `;

    // Event listeners
    document.getElementById('colorInput').addEventListener('input', (e) => {
      settings.color = e.target.value;
      document.documentElement.style.setProperty('--primary-color', settings.color);
      document.querySelectorAll('nav button.active').forEach(btn => {
        btn.style.backgroundColor = settings.color;
      });
      document.querySelectorAll('button').forEach(btn=>{
        if(btn.textContent==="Dengarkan") btn.style.backgroundColor = settings.color;
      });
    });

    document.getElementById('fontSizeInput').addEventListener('change', (e) => {
      let val = parseInt(e.target.value);
      if (val < 12) val = 12;
      if (val > 40) val = 40;
      settings.fontSize = val;
      e.target.value = val;
    });

    document.getElementById('soundToggle').addEventListener('change', (e) => {
      settings.soundEnabled = e.target.checked;
    });
  }

  // Fungsi render About
  function renderAbout() {
    clearActiveButtons();
    buttons.about.classList.add('active');
    content.innerHTML = `
      <h2>Tentang Aplikasi</h2>
      <p>Aplikasi ini merupakan output dari tugas mata kuliah digitalisasi Al-Qur'an mahasiswa angkatan 2022 IAI Persis Garut.</p>
      <p>Dirancang untuk belajar huruf hijaiyah, doa sehari-hari dan surat-surat pendek dengan suara dan tampilan menarik untuk anak-anak.</p>
    `;
  }

  // Visual effect flash on element
  function flashElement(el) {
    el.style.transition = 'transform 0.2s ease';
    el.style.transform = 'scale(1.3)';
    setTimeout(() => {
      el.style.transform = 'scale(1)';
    }, 200);
  }

  // Event listeners menu
  buttons.hijaiyah.addEventListener('click', () => {
    playClickSound();
    renderHijaiyah();
  });
  buttons.doa.addEventListener('click', () => {
    playClickSound();
    renderDoa();
  });
  buttons.surat.addEventListener('click', () => {
    playClickSound();
    renderSurat();
  });
  buttons.setting.addEventListener('click', () => {
    playClickSound();
    renderSetting();
  });
  buttons.about.addEventListener('click', () => {
    playClickSound();
    renderAbout();
  });

  // Inisialisasi halaman default
  window.addEventListener('load', () => {
    // Delay untuk memuat voice list
    let synthInterval = setInterval(() => {
      if (speechSynthesis.getVoices().length !== 0) {
        clearInterval(synthInterval);
      }
    }, 200);
    renderHijaiyah();
  });
</script>

</body>
</html>

